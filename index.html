<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/images/avatar.jpeg?v=5.1.1" />






<meta name="description" content="It takes everything.">
<meta property="og:type" content="website">
<meta property="og:title" content="HSEURY_POINTER">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="HSEURY_POINTER">
<meta property="og:description" content="It takes everything.">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HSEURY_POINTER">
<meta name="twitter:description" content="It takes everything.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>HSEURY_POINTER</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  















  
  
    
  

  <div class="container sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">HSEURY_POINTER</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Be kind, always.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-android">
          <a href="/categories/android" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            android
          </a>
        </li>
      
        
        <li class="menu-item menu-item-travel">
          <a href="/categories/travel" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            穿越世界的旅行
          </a>
        </li>
      
        
        <li class="menu-item menu-item-ios">
          <a href="/categories/ios" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            ios开发
          </a>
        </li>
      
        
        <li class="menu-item menu-item-backend">
          <a href="/categories/backend" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            后台开发
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/19/android-permission/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hseury">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HSEURY_POINTER">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/19/android-permission/" itemprop="url">安卓中的权限</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-19T16:20:44+08:00">
                2018-03-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/19/android-permission/" class="leancloud_visitors" data-flag-title="安卓中的权限">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1|q201:/ # ls -l data/data</span><br><span class="line">total 1104</span><br><span class="line">-rwxr-x--x system   system       4156 2012-06-30 16:12 test.apk.</span><br></pre></td></tr></table></figure>
<p>代表的是相应的<code>用户/用户组</code>及其他人对此文件的访问权限，与此文件运行起来具有的权限完全不相关<br>比如上面的例子只能说明system用户拥有对此文件的读写执行权限；system组的用户对此文件拥有读、执行权限；其他人对此文件只具有执行权限。而<code>test.apk</code>运行起来后可以干哪些事情，跟这个就不相关了。<br>千万不要看apk文件系统上属于<code>system/system用户及用户组</code>，或者<code>root/root用户及用户组</code>，就认为apk具有<code>system</code>或<code>root</code>权限。apk程序是运行在虚拟机上的,对应的是Android独特的权限机制，只有体现到文件系统上时才使用linux的权限设置。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drwx------ 4 u0_a24    u0_a24    4096 2015-01-01 00:00 org.chromium.webview_shell</span><br></pre></td></tr></table></figure>
<p>这是<code>/data/data</code>目录下的文件，可以看到只有UserID为u0_a24的程序才能读写该文件。</p>
<p><a href="https://zhuanlan.zhihu.com/p/22620803" target="_blank" rel="noopener">关于android UID u0_axx是怎么来的</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/12/everything-about-Launcher/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hseury">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HSEURY_POINTER">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/12/everything-about-Launcher/" itemprop="url">Launcher的备忘</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-12T09:22:49+08:00">
                2018-01-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/01/12/everything-about-Launcher/" class="leancloud_visitors" data-flag-title="Launcher的备忘">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h1><hr>
<p>主布局<code>launcher.xml</code>中， 最外层是<code>LauncherRootView</code>，重写了一个方法， View.fitSystemWindow(rect), 如果你的View在status bar或者navigation bar之下，那么这个方法会传递进去一个参数，说明这个View的四周有多少是被status bar或者navigation bar挡住了的。</p>
<blockquote>
</blockquote>
<p>Called by the view hierarchy when the content insets for a window have changed, to allow it to adjust its content to fit within those windows. The content insets tell you the space that the status bar, input method, and other system windows infringe on the application’s window.</p>
<p>这个方法的会调用父类的setInsets()方法，我们来看看父类InsettableFrameLayout。</p>
<p>InsettableFrameLayout继承了FrameLayout， 并且实现了父类的一些方法，总的来说，他的目的就是给子View都设定一个Margin值，防止被status bar或者navigation bar挡住。如果一个View已经是<code>Insettable</code>(一个接口)的了，那么就忽略他。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setInsets</span><span class="params">(Rect insets)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> n = getChildCount();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">final</span> View child = getChildAt(i);</span><br><span class="line">        setFrameLayoutChildInsets(child, insets, mInsets);</span><br><span class="line">    &#125;</span><br><span class="line">    mInsets.set(insets);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFrameLayoutChildInsets</span><span class="params">(View child, Rect newInsets, Rect oldInsets)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> LayoutParams lp = (LayoutParams) child.getLayoutParams();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (child <span class="keyword">instanceof</span> Insettable) &#123;</span><br><span class="line">        ((Insettable) child).setInsets(newInsets);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!lp.ignoreInsets) &#123;</span><br><span class="line">        lp.topMargin += (newInsets.top - oldInsets.top);</span><br><span class="line">        lp.leftMargin += (newInsets.left - oldInsets.left);</span><br><span class="line">        lp.rightMargin += (newInsets.right - oldInsets.right);</span><br><span class="line">        lp.bottomMargin += (newInsets.bottom - oldInsets.bottom);</span><br><span class="line">    &#125;</span><br><span class="line">    child.setLayoutParams(lp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在Launcher3中，Workspace， DragLayer和AppsCustomizeTabHost都实现了这个接口，那么他们自身就不会被加Margin， 而搜索栏和Hotseat都没有实现这个接口，那么说明他们在被加到父亲上得时候会被设一个Margin，最后的到得效果就是搜索栏刚好在status bar之下（gravity为top，topmargin是status bar的高度），Hotseat刚好在navigation bar的上方（gravity为bottom，bottomMargin为navigation bar的高度）</p>
<p><code>DragLayer</code></p>
<p>一个协调处理它的子view拖动的容器.</p>
<ul>
<li><a href="http://blog.csdn.net/qq_31530015/article/details/51548413" target="_blank" rel="noopener">Android4.4-Launcher源码分析系列之关键的类和接口之DragLayer</a></li>
</ul>
<p><code>Workspace</code></p>
<p>抽象的桌面。由N个celllaout组成，从CellLayout更高一级的层面上对事件的处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Workspace</span> <span class="keyword">extends</span> <span class="title">SmoothPagedView</span> <span class="keyword">implements</span> <span class="title">DropTarget</span>, <span class="title">DragSource</span>, <span class="title">DragScroller</span>, <span class="title">View</span>.<span class="title">OnTouchListener</span>,  </span></span><br><span class="line"><span class="class">        <span class="title">DragController</span>.<span class="title">DragListener</span>, <span class="title">LauncherTransitionable</span>, <span class="title">ViewGroup</span>.<span class="title">OnHierarchyChangeListener</span>,  </span></span><br><span class="line"><span class="class">        <span class="title">Insettable</span> </span>&#123;</span><br><span class="line">        	.......</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="http://blog.csdn.net/qq_31530015/article/details/51577154" target="_blank" rel="noopener">Android4.4-Launcher源码分析系列之WorkSpace及屏幕滑动</a></li>
</ul>
<p>既是一个拖动的容器也是一个拖动的源</p>
<p><code>Hotseat</code></p>
<p>Hotseat里面其实也是一个CellLayout负责管理内部的元素。</p>
<p><code>PageIndicator</code></p>
<p>dock栏上面的点点，默认横屏状态下没有。</p>
<p>在xml文件中，这些空间基本上都是FrameLayout，在<code>Launcher.java</code>的onCreate方法里进行布局的配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">   	......</span><br><span class="line">       <span class="comment">//初始化，但是xml里面的布局文件都没有设置绝对属性</span></span><br><span class="line">       setContentView(R.layout.launcher);</span><br><span class="line">       <span class="comment">//绑定监听</span></span><br><span class="line">       setupViews();</span><br><span class="line">       <span class="comment">//根据设备取出的信息来绘制</span></span><br><span class="line">       grid.layout(<span class="keyword">this</span>);</span><br><span class="line">       ......</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>其中grid.layout则是设置对各个控件的大小和位置<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">layout</span><span class="params">(Launcher launcher)</span> </span>&#123;</span><br><span class="line">	    <span class="comment">// Layout the workspace</span></span><br><span class="line">      PagedView workspace = (PagedView) launcher.findViewById(R.id.workspace);</span><br><span class="line">      lp = (FrameLayout.LayoutParams) workspace.getLayoutParams();</span><br><span class="line">      lp.gravity = Gravity.CENTER;</span><br><span class="line">      <span class="keyword">int</span> orientation = isLandscape ? CellLayout.LANDSCAPE : CellLayout.PORTRAIT;</span><br><span class="line">      Rect padding = getWorkspacePadding(orientation);</span><br><span class="line">      workspace.setLayoutParams(lp);</span><br><span class="line">      workspace.setPadding(padding.left, padding.top, padding.right, padding.bottom);</span><br><span class="line">      workspace.setPageSpacing(getWorkspacePageSpacing(orientation));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Layout the hotseat</span></span><br><span class="line">      View hotseat = launcher.findViewById(R.id.hotseat);</span><br><span class="line">      ......</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Layout the page indicators</span></span><br><span class="line">      View pageIndicator = launcher.findViewById(R.id.page_indicator);</span><br><span class="line">      ......</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Layout AllApps</span></span><br><span class="line">      AppsCustomizeTabHost host = (AppsCustomizeTabHost)</span><br><span class="line">              launcher.findViewById(R.id.apps_customize_pane);</span><br><span class="line">      ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="数据加载"><a href="#数据加载" class="headerlink" title="数据加载"></a>数据加载</h1><p><code>LauncherModel</code><br>继承BroadcastReceiver,由此可知他是一个广播接收器,用来接收广播,另外,LauncherModel还主要加载数据;</p>
<p><code>LauncherProvider</code><br>继承ContentProvider,主要是处理数据库操作;</p>
<p><code>LauncherAppState</code><br>单例模式的全局管理类,主要是初始化一些对象,注册广播等.</p>
<p>默认数据写在<code>default_workspace_4x4.xml</code>,<code>default_workspace_5x5.xml</code>和<code>default_workspace_5x6.xml</code>这几个xml文件中</p>
<p>当所有信息初始化完成后，就开始调用mModel.startLoader方法来加载应用数据。</p>
<p><code>loadAndBindWorkspace</code>方法，加载workspace的应用并且进行绑定，content里面取。</p>
<p><code>waitForIdle</code>方法，改方法主要是等待加载数据结束</p>
<p><code>loadAndBindAllApps</code>方法，加载第二层的多有图标信息</p>
<p><code>bindWorkspace</code>将数据和view进行绑定</p>
<h1 id="应用安装、更新、卸载时的数据加载"><a href="#应用安装、更新、卸载时的数据加载" class="headerlink" title="应用安装、更新、卸载时的数据加载"></a>应用安装、更新、卸载时的数据加载</h1><p>首先区分收到广播是安装、更新、移除还是不可用，然后对不同的操作执行不同的处理，对于添加的调用addAppsToAllApps这个方法进行处理，最后调用callbacks.bindAppsAdded方法进行绑定，更新的调用callbacks.bindAppsUpdated这个方法进行更新操作</p>
<h1 id="Workspace滑动"><a href="#Workspace滑动" class="headerlink" title="Workspace滑动"></a>Workspace滑动</h1><p><code>Workspace</code>继承<code>PagedView</code>，而<code>PagedView</code>又继承<code>ViewGroup</code>，<code>PagedView</code>是分页的自定义View</p>
<p>滑动事件有五种状态</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> TOUCH_STATE_REST = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> TOUCH_STATE_SCROLLING = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> TOUCH_STATE_PREV_PAGE = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> TOUCH_STATE_NEXT_PAGE = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> TOUCH_STATE_REORDERING = <span class="number">4</span>;</span><br></pre></td></tr></table></figure>
<p>第一个是初始状态，第二个是滚动状态，第三个是向前翻页状态，第四个是向后翻页状态，最后一个是排序状态（长按桌面的情况下，workspace缩小，此时你可以长按CellLayout拖动进行排序)</p>
<h1 id="拖曳事件"><a href="#拖曳事件" class="headerlink" title="拖曳事件"></a>拖曳事件</h1><p>图标拖拽的触发条件是长按事件，<code>Launcher</code>类的<code>onLongClick</code>方法。</p>
<p>DragController中的onTouch方法是在DragLayer中的onTouch方法中调用的</p>
<p><code>DragLayer.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">       ......</span><br><span class="line">       <span class="keyword">return</span> mDragController.onTouchEvent(ev);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><code>DragController.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleMoveEvent</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    mDragObject.dragView.move(x, y);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Drop on someone?</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span>[] coordinates = mCoordinatesTemp;</span><br><span class="line">    <span class="comment">//查找DropTarget</span></span><br><span class="line">    DropTarget dropTarget = findDropTarget(x, y, coordinates);</span><br><span class="line">    mDragObject.x = coordinates[<span class="number">0</span>];</span><br><span class="line">    mDragObject.y = coordinates[<span class="number">1</span>];</span><br><span class="line">    checkTouchMove(dropTarget);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check if we are hovering over the scroll areas</span></span><br><span class="line">    mDistanceSinceScroll +=</span><br><span class="line">        Math.sqrt(Math.pow(mLastTouch[<span class="number">0</span>] - x, <span class="number">2</span>) + Math.pow(mLastTouch[<span class="number">1</span>] - y, <span class="number">2</span>));</span><br><span class="line">    mLastTouch[<span class="number">0</span>] = x;</span><br><span class="line">    mLastTouch[<span class="number">1</span>] = y;</span><br><span class="line">    checkScrollState(x, y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>DropTarget</code><br>拖动你的View要放入的地方，比如folder，workspace等</p>
<p><code>DragObject</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Interface defining an object that can receive a drag.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DropTarget</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"DropTarget"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DragObject</span> </span>&#123;</span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mDragObject = <span class="keyword">new</span> DropTarget.DragObject();</span><br></pre></td></tr></table></figure>
<p><code>DragView</code><br>拖拽的是DragView对象</p>
<p><code>DragSource</code><br>标记拖曳事件哪里产生，比如workspace、floder<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Interface defining an object that can originate a drag.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DragSource</span> </span>&#123;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>acceptDrop函数用来判断dropTarget是否可以接受item放置在自己里面。</p>
<h1 id="MVC模式"><a href="#MVC模式" class="headerlink" title="MVC模式"></a>MVC模式</h1><p>Launcher从总体架构上来看采用了MVC模式。其中Launcher.java为控制器(C)，LauncherModel为模型(M)；XML界面配置文件为视图，其中Workspace等<code>view</code>,<code>framelayout</code>为视图容器(V)。模型中操作数据库模型，保持数据模型和数据库的一致。控制器同步视图和模型，视图和模型之间不直接关联，通过控制器发生关联。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/07/yunnan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hseury">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HSEURY_POINTER">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/07/yunnan/" itemprop="url">云南——不会再去的地方</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-07T14:09:20+08:00">
                2018-01-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/travel/" itemprop="url" rel="index">
                    <span itemprop="name">travel</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/01/07/yunnan/" class="leancloud_visitors" data-flag-title="云南——不会再去的地方">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="泸沽湖"><a href="#泸沽湖" class="headerlink" title="泸沽湖"></a>泸沽湖</h1><p>经过班机晚点，凌晨三点到达昆明，只休息了四个小时，早上七点到机场，再坐一个小时的飞机，一个小时的机场大巴等一系列折腾，我和我家医生终于到了飘着尘土的乡镇，确实是个很安静的地方，因为路上基本没有人。安顿好住宿，走出客栈，才第一眼感受到泸沽湖的美，湖水清澈见底，近处透明到绿，远处深深蓝色。旅途上的劳顿才觉得也是值得的。因为是淡季，湖边并没有特别多的游客。</p>
<p><img src="/2018/01/07/yunnan/IMG_0309.jpg" alt="泸沽湖第一印象"></p>
<p>先来介绍一下泸沽湖：泸沽湖，俗称左所海，古名勒得海、鲁枯湖，纳西族摩梭语“泸”为山沟，“沽”为里，意即山沟里的湖，湖位于四川省盐源县与云南省宁蒗县交界处，为川滇共辖，湖东为盐源县泸沽湖镇（原左所区），湖西为宁蒗县永宁乡。湖泊略呈北西一东南走向，南北长9.5公里，东西宽5.2公里，湖岸线长约44公里，湖泊面积50.1平方公里，集水面积247.6平方公里，最大水深105.3米，平均水深为40.3米，湖水库容量为22.52亿立方米，湖水最大透明度达12米，湖面海拔2685米。<br>泸沽湖属高原断层溶蚀陷落湖泊，由一个西北东南向的断层和两个东西向的断层共同构成。属长江上游干流金沙江支流雅砻江支流理塘河水系。泸沽湖入湖河流共18条（云南部分11条，四川部分7条），湖水经东侧的大草海注入盐源县境内前所河，再注入盖祖河（下游称永宁河），再注入卧龙河（又名卧落河、盐源河），入流理塘河，最后排入长江上游干流段金沙江的支流雅砻江。<br>泸沽湖是云南省海拔最高的湖泊，是中国第三大深水湖泊。泸沽湖周边主要居住着摩梭人、彝族和普米族，沿岸居住有蒙古族7种民族，约1.3万人。</p>
<h2 id="湖上之旅"><a href="#湖上之旅" class="headerlink" title="湖上之旅"></a>湖上之旅</h2><p>第一天下午比较空闲，坐了猪槽船，也就是独木舟。摩梭语称：“日故”。由一根粗壮的圆木镂空．两头削尖而成。因其状如一只长长的猪槽而得其名。泸沽湖与世隔绝。湖中的唯一交通工具是摩梭人独特的“猪槽船”。最先记载“猪槽船”的文献是清代道光《盐源县志》“夷民挎巨木中空，桦短以济，曰：猪槽船”。乘坐猪槽船去了里务比岛。太阳很晒，晒得我睁不开眼。</p>
<p><img src="/2018/01/07/yunnan/IMG_3066.jpg" alt="猪槽船"></p>
<p>在里务比岛登岛之后，我再差不多最高的地方拍了一张，我不由得感叹，我是不是真的应该出佳为尼，这彩色槽点确实不能忍。</p>
<p><img src="/2018/01/07/yunnan/IMG_2927.jpg" alt="里务比岛登顶"></p>
<p>坐船回来之后吃了当地的蒸气鱼，白煮的，味道还挺不错的。</p>
<p>第二天就开始了环湖之行。</p>
<h2 id="环湖之旅"><a href="#环湖之旅" class="headerlink" title="环湖之旅"></a>环湖之旅</h2><h3 id="情人滩"><a href="#情人滩" class="headerlink" title="情人滩"></a>情人滩</h3><p>对面是女神山和秀美的安娜俄岛，湖湾岸上的一座山，形似屈膝仰卧的睡美人当地人称之为“情人堡”，摩梭村寨青年男女，常邀约到山间互表衷情。湖湾的码头景象十分特别，数十条色彩鲜亮的游船，不是停靠岸边，而是随意漂浮在水中，别有一番意境。从湖湾的沿湖公路经过，可通往云南丽江。</p>
<p><img src="/2018/01/07/yunnan/IMG_3087.jpg" alt="情人滩"></p>
<h3 id="杨二车姆娜博物馆"><a href="#杨二车姆娜博物馆" class="headerlink" title="杨二车姆娜博物馆"></a>杨二车姆娜博物馆</h3><p>没有进去，在后山的山头上拍了一会儿照片，透过门缝看过去，里面的工作人员貌似在看电视机= =！</p>
<p><img src="/2018/01/07/yunnan/IMG_3261.jpg" alt="杨二车姆娜博物馆"></p>
<h3 id="里格半岛"><a href="#里格半岛" class="headerlink" title="里格半岛"></a>里格半岛</h3><p>里格村，位于丽江市宁蒗县泸沽湖的北侧，东西南三面环水，行成了以里格半岛为核心的“里格湾”。 村子坐落于格姆女神山下（当地人叫狮子山——因在永宁眺望该山如静卧的狮子而得名），房舍分布在湖湾和半岛上，独特的地理位置使得里格有着与别的村落不一样的湖光山色，小小的里格半岛更为游人所喜欢。在观景台可以看到湖水形成了一个心形。</p>
<p><img src="/2018/01/07/yunnan/IMG_3108.jpg" alt="里格半岛"></p>
<h3 id="草海"><a href="#草海" class="headerlink" title="草海"></a>草海</h3><p>草海在泸沽湖的东南面，由于长年的泥沙淤积，湖水较浅，因此生长有茂密的芦苇。草海全长约七千米，平均宽约八百米，面积九千余亩，属四川省盐源县左所乡管辖。寒冬季节，翠色苍茫。一日当中水色多变，黑压压的水鸟，在那里随波逐流，草海真正成了水鸟的世界。</p>
<p><img src="/2018/01/07/yunnan/IMG_3419.jpg" alt="草海"></p>
<p>在要回去的时候，山头出现了一片巨大的火烧云。</p>
<p><img src="/2018/01/07/yunnan/IMG_3445.jpg" alt="草海"></p>
<h3 id="格姆女神山"><a href="#格姆女神山" class="headerlink" title="格姆女神山"></a>格姆女神山</h3><p>格姆女神山海拔3754.7米，是泸沽湖四周最高的山峰。山顶的洞里有天然形成的石钟乳女性人像，因而在摩梭神话传说中，此山是格姆女神的化身。现已开通索道缆车直达半山腰的女神洞，乘坐缆车也可以饱览泸沽湖全景了。 转山节期间，摩梭人都要上女神山祭祀女神。从山头到山脚，转山的队伍形成一条条色彩绚丽的长龙，“女神歌”响彻云天。中国名山成十上百，格姆女神山以“天人合一”别具风采。    </p>
<p><img src="/2018/01/07/yunnan/IMG_3485.jpg" alt="格姆女神山"></p>
<h3 id="日月星辰"><a href="#日月星辰" class="headerlink" title="日月星辰"></a>日月星辰</h3><p>在泸沽湖不得不说这里的星星的，这是我第一次看到肉眼可见的满天繁星，but我家医生有点diss我，因为她是看着星星长大的。这次在客栈的天台，也算是完成了我拍摄星空的心愿。下一个就是学习好天文知识，去拍银河了。<br>大概7点半起床天还是黑的，肉眼可见漫天的星星。</p>
<p><img src="/2018/01/07/yunnan/IMG_3465_1.jpg" alt="泸沽湖晨曦"></p>
<p>很快天就亮了，不多久，大概八点半，太阳出来了。</p>
<p><img src="/2018/01/07/yunnan/IMG_3033.jpg" alt="泸沽湖日出"></p>
<h3 id="离开"><a href="#离开" class="headerlink" title="离开"></a>离开</h3><p>这里确实是慢生活，小狗都喜欢在路边晒太阳睡觉，走在路边，走累了，说，那边好像有石头可以坐下来歇个脚。走进了一看才发现，原来是两只躺在地上睡觉的小狗……</p>
<p>我们走进了，一点都不慌，也不叫，翻个身继续睡。</p>
<p>当地的居民也喜欢晒太阳，拿个保温杯放手机，眯上眼睛晒太阳，这应该是最有意义的生活了。</p>
<p>待了2天之后，我们就坐上大巴，去往丽江了，路途是盘山公路，有好多的弯。</p>
<p><img src="/2018/01/07/yunnan/WechatIMG108.jpeg" alt="盘山公路"></p>
<p>路上我们看到了翻掉的大巴车，小型泥石流，蜿蜒盘旋的金沙江。多少给枯燥的路途带来了一些其他的感受，一方面感慨我国风景优美之地多在环境恶劣危险之地，一方面也感慨人在大自然面前太渺小了，要珍爱生命。</p>
<h2 id="玉龙雪山"><a href="#玉龙雪山" class="headerlink" title="玉龙雪山"></a>玉龙雪山</h2><p>玉龙雪山为云南省丽江市境内雪山群，地处东经100°4′2″～100°16′30″、北纬27°3′2″～27°18′57″之间，在丽江北面约15千米处，全长75千米，是北半球最近赤道终年积雪的山脉，隔江西与中甸雪山、东与绵绵山相并列，北自三江口，向南延伸到北纬27°，如扇面向古城展开。全山的13座山峰由南向北纵向排列，主峰扇子陡最高处海拔5596米，终年积雪，发育有亚欧大陆距离赤道最近的温带海洋性冰川。玉龙雪山在纳西语中被称为“欧鲁”，意为银色的山岩。其十三座雪峰连绵不绝，宛若一条“巨龙”腾越飞舞，故称为“玉龙”。又因其岩性主要为石灰岩与玄武岩，黑白分明，所以又称为“黑白雪山”。是纳西人的神山，传说纳西族保护神“三多”的化身。</p>
<p>坐上缆车之后，直接上了4506的海拔，耳朵明显被塞住了，听声音有点困难，然后我完成了我在地球上海拔最高的地方的创作。</p>
<p><img src="/2018/01/07/yunnan/IMG_3641.jpg" alt="玉龙雪山"></p>
<p>而此时我家医生出现了高原反应，我们大概攀登了20米就下山了，这也反映出了大自然的伟大，面对大自然，人类要有敬畏之心，并非一定要攀登高峰才是胜利，量力而行也是人生的一部分。</p>
<p>山脚下的蓝月谷就是比较宜人的玩水之处了，这也一定程度上弥补了不能去九寨沟的遗憾。</p>
<p><img src="/2018/01/07/yunnan/IMG_3688.jpg" alt="蓝月谷"><br><img src="/2018/01/07/yunnan/IMG_3692.jpg" alt="蓝月谷"><br><img src="/2018/01/07/yunnan/IMG_3698.jpg" alt="蓝月谷"><br><img src="/2018/01/07/yunnan/IMG_3716.jpg" alt="蓝月谷"></p>
<p>最后一个疑问了，为何景色这么美，标题还会说再也不去了呢</p>
<p>原因有二：</p>
<p>一是这边消费经常性的强买强卖，询问问题不知所云，只有给他赚钱才给出有用信息。还卖的很贵。</p>
<p>二是因为确实高原不适合所有人，我们是反正不会再去啦。</p>
<p>就酱。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/07/about-IPC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hseury">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HSEURY_POINTER">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/07/about-IPC/" itemprop="url">IPC相关</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-07T18:00:07+08:00">
                2017-12-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/12/07/about-IPC/" class="leancloud_visitors" data-flag-title="IPC相关">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="IPC"><a href="#IPC" class="headerlink" title="IPC"></a>IPC</h1><h2 id="Serializeable和Parcelable"><a href="#Serializeable和Parcelable" class="headerlink" title="Serializeable和Parcelable"></a>Serializeable和Parcelable</h2><p>完成序列化和反序列化</p>
<p>Parcelable适合android</p>
<h2 id="Binder"><a href="#Binder" class="headerlink" title="Binder"></a>Binder</h2><p>IInterface，Stub， Proxy</p>
<h2 id="IPC方式"><a href="#IPC方式" class="headerlink" title="IPC方式"></a>IPC方式</h2><ul>
<li><p>Bundle  + Intent</p>
</li>
<li><p>文件共享（eg sharedPreference）</p>
</li>
<li><p>Messager(底层AIDL)</p>
</li>
<li><p>AIDL</p>
</li>
</ul>
<p>可用于调用其他应用进行授权（例如微信授权登陆）</p>
<ul>
<li><p>ContentProvider</p>
</li>
<li><p>Socket</p>
</li>
</ul>
<h1 id="AIDL和Binder"><a href="#AIDL和Binder" class="headerlink" title="AIDL和Binder"></a>AIDL和Binder</h1><p>参考AIDL自动生成的代码</p>
<p>IRemoteServer.aidl -&gt; IRemoteServer.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * This file is auto-generated.  DO NOT MODIFY.</span></span><br><span class="line"><span class="comment"> * Original file: /Users/hseury/codes/IPCClient/app/src/main/aidl/aidl/IRemoteServer.aidl</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> aidl;</span><br><span class="line"><span class="comment">// Declare any non-default types here with import statements</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IRemoteServer</span> <span class="keyword">extends</span> <span class="title">android</span>.<span class="title">os</span>.<span class="title">IInterface</span> </span>&#123;</span><br><span class="line">	<span class="comment">/** Local-side IPC implementation stub class. */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Stub</span> <span class="keyword">extends</span> <span class="title">android</span>.<span class="title">os</span>.<span class="title">Binder</span> <span class="keyword">implements</span> <span class="title">aidl</span>.<span class="title">IRemoteServer</span> </span>&#123;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> java.lang.String DESCRIPTOR = <span class="string">"aidl.IRemoteServer"</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/** Construct the stub at attach it to the interface. */</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="title">Stub</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">this</span>.attachInterface(<span class="keyword">this</span>, DESCRIPTOR);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * Cast an IBinder object into an aidl.IRemoteServer interface,</span></span><br><span class="line"><span class="comment">		 * generating a proxy if needed.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">static</span> aidl.<span class="function">IRemoteServer <span class="title">asInterface</span><span class="params">(android.os.IBinder obj)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">if</span> ((obj == <span class="keyword">null</span>)) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			android.os.IInterface iin = obj.queryLocalInterface(DESCRIPTOR);</span><br><span class="line">			<span class="keyword">if</span> (((iin != <span class="keyword">null</span>) &amp;&amp; (iin <span class="keyword">instanceof</span> aidl.IRemoteServer))) &#123;</span><br><span class="line">				<span class="keyword">return</span> ((aidl.IRemoteServer) iin);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> aidl.IRemoteServer.Stub.Proxy(obj);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span> <span class="keyword">public</span> android.os.<span class="function">IBinder <span class="title">asBinder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTransact</span><span class="params">(<span class="keyword">int</span> code, android.os.Parcel data, android.os.Parcel reply,</span></span></span><br><span class="line"><span class="function"><span class="params">				<span class="keyword">int</span> flags)</span> <span class="keyword">throws</span> android.os.RemoteException </span>&#123;</span><br><span class="line">			<span class="keyword">switch</span> (code) &#123;</span><br><span class="line">				<span class="keyword">case</span> INTERFACE_TRANSACTION: &#123;</span><br><span class="line">					reply.writeString(DESCRIPTOR);</span><br><span class="line">					<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">case</span> TRANSACTION_add: &#123;</span><br><span class="line">					data.enforceInterface(DESCRIPTOR);</span><br><span class="line">					<span class="keyword">int</span> _arg0;</span><br><span class="line">					_arg0 = data.readInt();</span><br><span class="line">					<span class="keyword">int</span> _arg1;</span><br><span class="line">					_arg1 = data.readInt();</span><br><span class="line">					<span class="keyword">int</span> _result = <span class="keyword">this</span>.add(_arg0, _arg1);</span><br><span class="line">					reply.writeNoException();</span><br><span class="line">					reply.writeInt(_result);</span><br><span class="line">					<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">super</span>.onTransact(code, data, reply, flags);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">aidl</span>.<span class="title">IRemoteServer</span> </span>&#123;</span><br><span class="line">			<span class="keyword">private</span> android.os.IBinder mRemote;</span><br><span class="line"></span><br><span class="line">			Proxy(android.os.IBinder remote) &#123;</span><br><span class="line">				mRemote = remote;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="meta">@Override</span> <span class="keyword">public</span> android.os.<span class="function">IBinder <span class="title">asBinder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				<span class="keyword">return</span> mRemote;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">public</span> java.lang.<span class="function">String <span class="title">getInterfaceDescriptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				<span class="keyword">return</span> DESCRIPTOR;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> <span class="keyword">throws</span> android.os.RemoteException </span>&#123;</span><br><span class="line">				android.os.Parcel _data = android.os.Parcel.obtain();</span><br><span class="line">				android.os.Parcel _reply = android.os.Parcel.obtain();</span><br><span class="line">				<span class="keyword">int</span> _result;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					_data.writeInterfaceToken(DESCRIPTOR);</span><br><span class="line">					_data.writeInt(a);</span><br><span class="line">					_data.writeInt(b);</span><br><span class="line">					mRemote.transact(Stub.TRANSACTION_add, _data, _reply, <span class="number">0</span>);</span><br><span class="line">					_reply.readException();</span><br><span class="line">					_result = _reply.readInt();</span><br><span class="line">				&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">					_reply.recycle();</span><br><span class="line">					_data.recycle();</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> _result;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TRANSACTION_add = (android.os.IBinder.FIRST_CALL_TRANSACTION + <span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> <span class="keyword">throws</span> android.os.RemoteException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>内部类<code>Stub</code>继承自<code>Binder</code>实现了<code>aidl.IRemoteServer</code>接口</p>
<p><code>Stub</code>的内部类<code>proxy</code>同样实现了<code>aidl.IRemoteServer</code>接口， 负责另一个进程和本进程的数据交互。</p>
<p>客户端和服务器都有这份代码</p>
<p>客户端其他代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bindService</span><span class="params">()</span></span>&#123;</span><br><span class="line">	Intent intent=<span class="keyword">new</span> Intent();</span><br><span class="line">	intent.setComponent(<span class="keyword">new</span> ComponentName(<span class="string">"org.hseury.ipcserver"</span>,<span class="string">"org.hseury.ipcserver.RemoteService"</span>));</span><br><span class="line">	bindService(intent,conn, Context.BIND_AUTO_CREATE);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> ServiceConnection conn=<span class="keyword">new</span> ServiceConnection() &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>&#123;</span><br><span class="line">		iRemoteAidl=   IRemoteServer.Stub.asInterface(service);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>&#123;</span><br><span class="line">		iRemoteAidl=<span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">super</span>.onDestroy();</span><br><span class="line">	unbindService(conn);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>客户端启动服务端的service, 调用bindService之后，回调onServiceConnected, 获得被包装好的Binder。</p>
<blockquote>
<p>这里仅仅从用法来熟悉Binder的操作，并没有从原理上深入理解Binder如何实现跨进程的数据传说，仅仅把Binder理解为数据传输的介质，就和电话一样。</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/06/everything-about-IME/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hseury">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HSEURY_POINTER">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/06/everything-about-IME/" itemprop="url">输入法IME相关知识备忘</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-06T14:07:43+08:00">
                2017-12-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/12/06/everything-about-IME/" class="leancloud_visitors" data-flag-title="输入法IME相关知识备忘">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="http://ju.outofmemory.cn/entry/330425" target="_blank" rel="noopener">UI层面</a></p>
<p><a href="http://blog.csdn.net/aiynmimi/article/details/51673862" target="_blank" rel="noopener">向输入框输入文本信息</a></p>
<p><a href="http://blog.csdn.net/qq_25827845/article/details/52373345" target="_blank" rel="noopener">输入法流程</a></p>
<p><a href="https://notes.wanghao.work/2015-04-01-Create-an-Android-IME.html" target="_blank" rel="noopener">输入法相关知识</a></p>
<p><a href="http://blog.csdn.net/u013278099/article/details/52433192" target="_blank" rel="noopener">aidl</a></p>
<h1 id="重要api"><a href="#重要api" class="headerlink" title="重要api"></a>重要api</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onEvaluateInputViewShown</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onShowInputRequested</span><span class="params">(<span class="keyword">int</span> paramInt, <span class="keyword">boolean</span> paramBoolean)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/01/spring-boot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hseury">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HSEURY_POINTER">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/01/spring-boot/" itemprop="url">SpringBoot初体验</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-01T22:08:49+08:00">
                2017-10-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/backend/" itemprop="url" rel="index">
                    <span itemprop="name">backend</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/10/01/spring-boot/" class="leancloud_visitors" data-flag-title="SpringBoot初体验">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>选择SpringBoot作为后台开发的框架，主要原因是自己对于java比对javescript更为熟悉</p>
</blockquote>
<h1 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h1><p>IDEA 2017<br>JDK 1.8<br>MAVEN 3.5.0</p>
<h1 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/SpringBoot"</span>)</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WidgetController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/hello"</span>,method = RequestMethod.GET,produces = &#123;MediaType.APPLICATION_JSON_VALUE&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">helloSpringBoot</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello SpringBoot!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/user"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map <span class="title">getUsers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"name"</span>,<span class="string">"hseury"</span>);</span><br><span class="line">        map.put(<span class="string">"age"</span>,<span class="string">"25"</span>);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2017/10/01/spring-boot/hello.png" alt="hello接口"></p>
<p><img src="/2017/10/01/spring-boot/user.png" alt="user接口"></p>
<p><code>@RequestMapping</code>注解提供“路由”信息。<br><code>@RestController</code>注解告诉Spring将生成的字符串直接返回给调用者。<br><code>@SpringBootApplication</code>注解相当于使用<code>@Configuration</code>，<code>@EnableAutoConfiguration</code>和<code>@ComponentScan</code>和他们的默认属性。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/01/backend-develop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hseury">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HSEURY_POINTER">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/01/backend-develop/" itemprop="url">后台开发备忘</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-01T14:31:50+08:00">
                2017-10-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/backend/" itemprop="url" rel="index">
                    <span itemprop="name">backend</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/10/01/backend-develop/" class="leancloud_visitors" data-flag-title="后台开发备忘">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>不要求特别精通后台开发，了解和熟悉接口如何处理</p>
</blockquote>
<h1 id="事件驱动编程"><a href="#事件驱动编程" class="headerlink" title="事件驱动编程"></a>事件驱动编程</h1><h1 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h1><p>指向客户端提供它所发出的请求的内容的机制</p>
<h1 id="请求和响应对象"><a href="#请求和响应对象" class="headerlink" title="请求和响应对象"></a>请求和响应对象</h1><h2 id="url的组成部分"><a href="#url的组成部分" class="headerlink" title="url的组成部分"></a>url的组成部分</h2><p>示例：</p>
<blockquote>
<p><a href="http://www.bing.com/search?q=grunt&amp;first=9#history" target="_blank" rel="noopener">http://www.bing.com/search?q=grunt&amp;first=9#history</a></p>
</blockquote>
<h3 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h3><p><code>http</code>, <code>https</code>, <code>file</code>, <code>ftp</code></p>
<h3 id="主机名"><a href="#主机名" class="headerlink" title="主机名"></a>主机名</h3><p><a href="http://www.bing.com" target="_blank" rel="noopener">www.bing.com</a></p>
<h3 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h3><h3 id="路径"><a href="#路径" class="headerlink" title="路径"></a>路径</h3><p>search</p>
<h3 id="查询字符串"><a href="#查询字符串" class="headerlink" title="查询字符串"></a>查询字符串</h3><p>?q=grunt&amp;first=9</p>
<h3 id="信息片段"><a href="#信息片段" class="headerlink" title="信息片段"></a>信息片段</h3><p>仅在浏览器使用，不会传递到服务器</p>
<p>#history</p>
<h1 id="踩过的坑"><a href="#踩过的坑" class="headerlink" title="踩过的坑"></a>踩过的坑</h1><h2 id="重复启动web-app"><a href="#重复启动web-app" class="headerlink" title="重复启动web app"></a>重复启动web app</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -i :8080 | grep LISTEN</span><br></pre></td></tr></table></figure>
<p>拿到进程号之后kill掉</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/11/analyse-chrome-public/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hseury">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HSEURY_POINTER">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/11/analyse-chrome-public/" itemprop="url">chromepublic源码分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-11T23:02:52+08:00">
                2017-08-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/08/11/analyse-chrome-public/" class="leancloud_visitors" data-flag-title="chromepublic源码分析">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h1><p><code>app/src/main/java/org/chromium/chrome/browser/document/ChromeLauncherActivity.java</code></p>
<p>ChromeLauncherActivity</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">doOnCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// This Activity is only transient. It launches another activity and</span></span><br><span class="line">        <span class="comment">// terminates itself. However, some of the work is performed outside of</span></span><br><span class="line">        <span class="comment">// &#123;@link Activity#onCreate()&#125;. To capture this, the TraceEvent starts</span></span><br><span class="line">        <span class="comment">// in onCreate(), and ends in onPause().</span></span><br><span class="line">        <span class="comment">// Needs to be called as early as possible, to accurately capture the</span></span><br><span class="line">        <span class="comment">// time at which the intent was received.</span></span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>启动后就跳到 CustomTabActivity，并把自己回收掉。</p>
<p>CustomTabActivity里面有mTab</p>
<p>Tab类里，有AndroidWindow和ContentViewCore,这些都是webview的内部成员，这里tab直接和webview的组件进行交互，不通过webview来进行回调。</p>
<h1 id="地址栏的维护"><a href="#地址栏的维护" class="headerlink" title="地址栏的维护"></a>地址栏的维护</h1><p>单tab页，最复杂的就是地址栏的维护</p>
<p>分为三个状态，正常态(normal),编辑态（edited）,高亮态（highlighted），高亮对应选中整个url链接</p>
<p>正常态，显示链接的title，左侧没有图标</p>
<p>点击一下，转化高亮态，此时左边有图标（重新加载），整个title变为网页的url，这个url底色为绿色</p>
<p>再点击一下，转化为编辑态，此时光标闪动，可以对url进行编辑，此时左侧图标是搜索。</p>
<h1 id="menu的创建"><a href="#menu的创建" class="headerlink" title="menu的创建"></a>menu的创建</h1><p>虽然BrowserActivity是自己实现了弹出menu悬浮窗的效果，但是还是借鉴了activity自带的menu的生命周期。减少了维护逻辑的成本。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showMenu</span><span class="params">(View anchor)</span> </span>&#123;</span><br><span class="line">    Activity activity = mUiController.getActivity();</span><br><span class="line">    <span class="keyword">if</span> (mPopupMenu == <span class="keyword">null</span>) &#123;</span><br><span class="line">        mPopupMenu = <span class="keyword">new</span> PopupMenu(getContext(), anchor);</span><br><span class="line">        mPopupMenu.setOnMenuItemClickListener(<span class="keyword">this</span>);</span><br><span class="line">        mPopupMenu.setOnDismissListener(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (!activity.onCreateOptionsMenu(mPopupMenu.getMenu())) &#123;</span><br><span class="line">            mPopupMenu = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Menu menu = mPopupMenu.getMenu();</span><br><span class="line">    <span class="keyword">if</span> (activity.onPrepareOptionsMenu(menu)) &#123;</span><br><span class="line">        mOverflowMenuShowing = <span class="keyword">true</span>;</span><br><span class="line">        mPopupMenu.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>onCreateOptionsMenu和onPrepareOptionsMenu在browseractivity中被重写。</p>
<p>onOptionsItemSelected负责处理点击事件</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/25/highway-to-Ios/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hseury">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HSEURY_POINTER">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/25/highway-to-Ios/" itemprop="url">Ios高速之路</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-25T22:37:19+08:00">
                2017-07-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ios/" itemprop="url" rel="index">
                    <span itemprop="name">ios</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/07/25/highway-to-Ios/" class="leancloud_visitors" data-flag-title="Ios高速之路">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Ios初探"><a href="#Ios初探" class="headerlink" title="Ios初探"></a>Ios初探</h1><h2 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h2><h2 id="xib和storyboard差不多？"><a href="#xib和storyboard差不多？" class="headerlink" title="xib和storyboard差不多？"></a>xib和storyboard差不多？</h2><h2 id="Xcode工具"><a href="#Xcode工具" class="headerlink" title="Xcode工具"></a>Xcode工具</h2><p>self = [super initWithNibName:<code>nibNameOrNil</code> bundle:<code>nibBundleOrNil</code>];</p>
<p>self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil];</p>
<p>要把回车键按下，把占位符（灰色背景）的部分变成实际的代码。</p>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>变量前面一定要加*</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//alloc and init items</span><br><span class="line">NSMutableArray *items = [[NSMutableArray alloc] init];</span><br><span class="line">     ......      </span><br><span class="line">for (NSString *s in items) &#123;</span><br><span class="line">     NSLog(@&quot;%@&quot;,s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="格式字符串"><a href="#格式字符串" class="headerlink" title="格式字符串"></a>格式字符串</h3><p>与c一致</p>
<p><code>%@</code>对应指向任意一种对象的指针</p>
<h3 id="类和对象"><a href="#类和对象" class="headerlink" title="类和对象"></a>类和对象</h3><p><code>@interface</code> 类申明</p>
<p><code>.h</code>文件，<code>@interface</code>和<code>@end</code>开始结尾。</p>
<p><code>.m</code>文件，<code>@implementation</code>和<code>@end</code>开始结尾。</p>
<p>OC和java一样，有默认值，（null和0）</p>
<p>字符串前面一定加@</p>
<p>不能<code>._value</code>直接拿到对象，要用方法申明的value【这条规则感觉略蛋疼】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface Item : NSObject&#123;</span><br><span class="line">    NSString *_itenName;</span><br><span class="line">    NSString *_serialNumber;</span><br><span class="line">    int _valueInDollars;</span><br><span class="line">    NSData *_dateCreated;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//method declare</span><br><span class="line">-(void) setItemName:(NSString*)str;</span><br><span class="line">-(NSString *) itemName;</span><br><span class="line">-(void) setSerialNumber:(NSString *)str;</span><br><span class="line">-(NSString *)serialNumber;</span><br><span class="line">-(void)setValueInDollars:(int)v;</span><br><span class="line">-(int)valueInDollars;</span><br><span class="line">-(NSData*)dateCreated;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>消息发送调用方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">      [item setItemName:@&quot;red sofa&quot;];</span><br><span class="line">      [item setSerialNumber:@&quot;A1B2C3&quot;];</span><br><span class="line">      [item setValueInDollars:100];</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>点方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  item.itemName = @&quot;black cat&quot;; //注意此处点运算符后面的不是成员变量_XXXX,而是方法名XXXX</span><br><span class="line">  item.serialNumber = @&quot;A1B2C3D4&quot;;</span><br><span class="line">  item.valueInDollars = 120;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h1 id="采坑之路"><a href="#采坑之路" class="headerlink" title="采坑之路"></a>采坑之路</h1><h2 id="cocopod不能更新"><a href="#cocopod不能更新" class="headerlink" title="cocopod不能更新"></a>cocopod不能更新</h2><p>报错</p>
<blockquote>
<p>Unable to add a source with url <code>http://XXXXX/iOS_Specs.git</code> named <code>0-apple_sdk-ios_specs</code>.<br>You can try adding it manually in <code>~/.cocoapods/repos</code> or via <code>pod repo add</code>.</p>
</blockquote>
<p>只能手动克隆repo的master仓库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/CocoaPods/Specs.git ~/.cocoapods/repos/master</span><br><span class="line">pod repo update</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/11/tips-about-android/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hseury">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HSEURY_POINTER">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/11/tips-about-android/" itemprop="url">安卓开发过程中的坑备忘</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-11T09:09:46+08:00">
                2017-07-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/07/11/tips-about-android/" class="leancloud_visitors" data-flag-title="安卓开发过程中的坑备忘">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="零碎"><a href="#零碎" class="headerlink" title="零碎"></a>零碎</h1><h2 id="activity-alias"><a href="#activity-alias" class="headerlink" title="activity-alias"></a>activity-alias</h2><p>在chrome代码中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity-alias</span> <span class="attr">android:name</span>=<span class="string">"com.google.android.apps.chrome.Main"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">android:targetActivity</span>=<span class="string">"org.chromium.chrome.browser.document.ChromeLauncherActivity"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">android:exported</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.BROWSABLE"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.APP_BROWSER"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.NOTIFICATION_PREFERENCES"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.MULTIWINDOW_LAUNCHER"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Matches the common case of intents with no MIME type.</span></span><br><span class="line"><span class="comment">                 Make sure to keep in sync with the next filter.  --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.VIEW"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.BROWSABLE"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"googlechrome"</span> /&gt;</span>                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"http"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"https"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"about"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"javascript"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Same filter as above but with MIME types.  Intents that</span></span><br><span class="line"><span class="comment">                 do not specify a MIME type won't match. --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.VIEW"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.BROWSABLE"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"googlechrome"</span> /&gt;</span>                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"http"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"https"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"about"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"content"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"javascript"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:mimeType</span>=<span class="string">"text/html"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:mimeType</span>=<span class="string">"text/plain"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:mimeType</span>=<span class="string">"application/xhtml+xml"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- MHTML support, used for snapshots --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.VIEW"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"file"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"content"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:mimeType</span>=<span class="string">"multipart/related"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.VIEW"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.BROWSABLE"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"file"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"content"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:host</span>=<span class="string">"*"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:pathPattern</span>=<span class="string">"/.*\\.mhtml"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:pathPattern</span>=<span class="string">"/.*\\.mht"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Same filter as above but with mimeType="*/*". Used for</span></span><br><span class="line"><span class="comment">                 handling intent send by ShareIt. --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.VIEW"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.BROWSABLE"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"file"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"content"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:host</span>=<span class="string">"*"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:mimeType</span>=<span class="string">"*/*"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:pathPattern</span>=<span class="string">"/.*\\.mhtml"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:pathPattern</span>=<span class="string">"/.*\\.mht"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MEDIA_SEARCH"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.speech.action.VOICE_SEARCH_RESULTS"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.nfc.action.NDEF_DISCOVERED"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"http"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"https"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.SEARCH"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"com.sec.android.airview.HOVER"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">android:name</span>=<span class="string">"android.app.searchable"</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">android:resource</span>=<span class="string">"@xml/searchable"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity-alias</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Android可以利用 <activity-alias> 动态改变 App 桌面图标</activity-alias></p>
<p>可以参考<a href="http://blog.csdn.net/eclipsexys/article/details/53791818" target="_blank" rel="noopener">动态更换应用Icon</a></p>
<p>可以参考<a href="http://www.jianshu.com/p/7b52e278508e" target="_blank" rel="noopener"><activity-alias> 标签的使用</activity-alias></a></p>
<h1 id="自定义view"><a href="#自定义view" class="headerlink" title="自定义view"></a>自定义view</h1><h2 id="findViewById为空"><a href="#findViewById为空" class="headerlink" title="findViewById为空"></a>findViewById为空</h2><p>在使用Dialog时，在调用dialog.show()方法之后，才能findViewById()找到对象</p>
<p>如果不调用dialog.show()方法，则findViewById()返回值为空</p>
<p><a href="http://blog.csdn.net/y12345654321/article/details/72673270" target="_blank" rel="noopener">从源码看 AlertDialog.getButton(DialogInterface.BUTTON_POSITIVE) 为什么是 null</a></p>
<h2 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h2><p>android:gravity是对元素本身说的，元素本身的文本显示在什么地方。</p>
<p>android:layout_gravity是相对与它的父元素说的，说明元素显示在父元素的什么位置</p>
<p>android:padding和android:layout_margin的区别，其实概念很简单，padding是站在父view的角度描述问题，它规定它里面的内容必须与这个父view边界的距离。margin则是站在自己的角度描述问题，规定自己和其他（上下左右）的view之间的距离，如果同一级只有一个view，那么它的效果基本上就和padding一样了。</p>
<h2 id="view的构造函数"><a href="#view的构造函数" class="headerlink" title="view的构造函数"></a>view的构造函数</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第一属于程序内实例化时采用，之传入Context即可<br>第二个用于layout文件实例化，会把XML内的参数通过AttributeSet带入到View内。<br>第三个主题的style信息，也会从XML里带入</p>
<h2 id="FrameLayout或者LinearLayout"><a href="#FrameLayout或者LinearLayout" class="headerlink" title="FrameLayout或者LinearLayout"></a>FrameLayout或者LinearLayout</h2><p>成员imageView调用setTransitionX()方法不生效</p>
<p>不存在的，要确定可见性</p>
<h2 id="View的scrollTo-方法不生效"><a href="#View的scrollTo-方法不生效" class="headerlink" title="View的scrollTo()方法不生效"></a>View的scrollTo()方法不生效</h2><p>怀疑是view不可见引起的(划掉)</p>
<p>不存在，可能是scrollto滑动方向与预期的相反导致的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrollTo(<span class="number">144</span>,<span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<p>本以为是从左向右移动，实际上是从右往左移动。</p>
<h2 id="View的style文件也会影响view的触发事件"><a href="#View的style文件也会影响view的触发事件" class="headerlink" title="View的style文件也会影响view的触发事件"></a>View的style文件也会影响view的触发事件</h2><p>在代码移植过程中，发现View的onfocuschanged方法一直不能回调</p>
<p>仔细对比代码也检查不出来哪里出问题了</p>
<p>后来发现是，当初为了加快移植节奏，样式问题没有调整，style文件没有指定</p>
<h2 id="ViewPager的事件拦截机制"><a href="#ViewPager的事件拦截机制" class="headerlink" title="ViewPager的事件拦截机制"></a>ViewPager的事件拦截机制</h2><p>onInterceptTouchEvent没有down事件，ontouchevent有move事件?</p>
<p>首先是一段log：</p>
<p>log打在这个viewpager的<code>dispatchTouchEvent</code>,<code>onInterceptTouchEvent</code>和<code>onTouchEvent</code>方法中。result表示该方法的返回值。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">07-20 23:56:47.192 10079-10079/com.browser E/check_drag: dispatchTouchEvent event 0</span><br><span class="line">07-20 23:56:47.192 10079-10079/com.browser E/check_drag: onInterceptTouchEvent event 0 index = 1 2</span><br><span class="line">07-20 23:56:47.192 10079-10079/com.browser E/check_drag: onInterceptTouchEvent event 1 result = false</span><br><span class="line">07-20 23:56:47.192 10079-10079/com.browser E/check_drag: onTouchEvent event 0</span><br><span class="line">07-20 23:56:47.192 10079-10079/com.browser E/check_drag: onTouchEvent event 1 result = true</span><br><span class="line">07-20 23:56:47.212 10079-10079/com.browser E/check_drag: dispatchTouchEvent event 2</span><br><span class="line">07-20 23:56:47.212 10079-10079/com.browser E/check_drag: onTouchEvent event 2</span><br><span class="line">07-20 23:56:47.212 10079-10079/com.browser E/check_drag: onTouchEvent event 1 result = true</span><br><span class="line">07-20 23:56:47.342 10079-10079/com.browser E/check_drag: dispatchTouchEvent event 2</span><br><span class="line">07-20 23:56:47.342 10079-10079/com.browser E/check_drag: onTouchEvent event 2</span><br><span class="line">07-20 23:56:47.342 10079-10079/com.browser E/check_drag: onTouchEvent event 1 result = true</span><br><span class="line">07-20 23:56:47.362 10079-10079/com.browser E/check_drag: dispatchTouchEvent event 2</span><br><span class="line">07-20 23:56:47.362 10079-10079/com.browser E/check_drag: onTouchEvent event 2</span><br><span class="line">07-20 23:56:47.902 10079-10079/com.browser E/check_drag: dispatchTouchEvent event 1</span><br><span class="line">07-20 23:56:47.902 10079-10079/com.browser E/check_drag: onTouchEvent event 1</span><br><span class="line">07-20 23:56:47.912 10079-10079/com.browser E/check_drag: onTouchEvent event 1 result = true</span><br></pre></td></tr></table></figure>
<p>按照google官方文档的说明：</p>
<blockquote>
<p>如果onInterceptTouchEvent方法返回true，那么它将不会收到后续事件，事件将会直接传递给目标的onTouchEvent方法（其实会先传给目标的onTouch方法）<br>如果onInterceptTouchEvent方法返回false，那么所有的后续事件都会先传给onInterceptTouchEvent，然后再传给目标的onTouchEvent方法。</p>
</blockquote>
<p>但是，为什么我们在onInterceptTouchEvent方法中返回false之后，却收不到后续的事件呢？？通过实验以及stackoverflow上面的一些问答得知，当我们在onInterceptTouchEvent（）方法中返回false，且View的onTouchEvent返回false的情况下，onInterceptTouchEvent方法才会收到后续的事件。</p>
<p>将上面程序的<code>onTouchEvent</code>方法强制返回false，得到下面的log。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">07-21 00:06:08.352 12604-12604/com.browser E/check_drag: dispatchTouchEvent event 0</span><br><span class="line">07-21 00:06:08.352 12604-12604/com.browser E/check_drag: onInterceptTouchEvent event 0 index = 1 2</span><br><span class="line">07-21 00:06:08.352 12604-12604/com.browser E/check_drag: onInterceptTouchEvent event 1 result = false</span><br><span class="line">07-21 00:06:08.382 12604-12604/com.browser E/check_drag: dispatchTouchEvent event 2</span><br><span class="line">07-21 00:06:08.382 12604-12604/com.browser E/check_drag: onInterceptTouchEvent event 2 index = 1 2</span><br><span class="line">07-21 00:06:08.382 12604-12604/com.browser E/check_drag: onInterceptTouchEvent event 1 result = false</span><br><span class="line">07-21 00:06:08.402 12604-12604/com.browser E/check_drag: dispatchTouchEvent event 2</span><br><span class="line">07-21 00:06:08.402 12604-12604/com.browser E/check_drag: onInterceptTouchEvent event 2 index = 1 2</span><br><span class="line">07-21 00:06:08.402 12604-12604/com.browser E/check_drag: onInterceptTouchEvent event 1 result = false</span><br><span class="line">07-21 00:06:08.562 12604-12604/com.browser E/check_drag: dispatchTouchEvent event 2</span><br><span class="line">07-21 00:06:08.562 12604-12604/com.browser E/check_drag: onInterceptTouchEvent event 2 index = 1 2</span><br><span class="line">07-21 00:06:08.562 12604-12604/com.browser E/check_drag: onInterceptTouchEvent event 1 result = true</span><br><span class="line">07-21 00:06:08.582 12604-12604/com.browser E/check_drag: dispatchTouchEvent event 2</span><br><span class="line">07-21 00:06:08.582 12604-12604/com.browser E/check_drag: onTouchEvent event 2</span><br><span class="line">07-21 00:06:08.602 12604-12604/com.browser E/check_drag: dispatchTouchEvent event 2</span><br><span class="line">07-21 00:06:08.602 12604-12604/com.browser E/check_drag: onTouchEvent event 2</span><br><span class="line">07-21 00:06:08.612 12604-12604/com.browser E/check_drag: dispatchTouchEvent event 2</span><br><span class="line">07-21 00:06:08.612 12604-12604/com.browser E/check_drag: onTouchEvent event 2</span><br><span class="line">07-21 00:06:08.612 12604-12604/com.browser E/check_drag: onTouchEvent event 1 result = true</span><br><span class="line">07-21 00:06:09.612 12604-12604/com.browser E/check_drag: dispatchTouchEvent event 1</span><br><span class="line">07-21 00:06:09.612 12604-12604/com.browser E/check_drag: onTouchEvent event 1</span><br><span class="line">07-21 00:06:09.612 12604-12604/com.browser E/check_drag: onTouchEvent event 1 result = true</span><br></pre></td></tr></table></figure>
<p>可见，在当前view，dispatchTouchEvent每次手势滑动都会传递，onInterceptTouchEvent返回false，表示不拦截事件，则ontouchevent不调用，onInterceptTouchEvent返回true，表示拦截事件，onTouchEvent会处理，但是如果第一次onTouchEvent返回true，则以后的onInterceptTouchEvent都不会被调用，因为view已经确认要处理事件了。</p>
<p>虽然这个结果与官方文档的说法有点不同，但实验说明是正确的。仔细想想这样的逻辑也确实非常合理：因为onInterceptTouchEvent方法是用来拦截触摸事件，防止被View捕获。那么现在View在onTouchEvent中返回fTrue，明确声明自己会处理这个触摸事件，那么这个时候就不需要拦截了，因此onInterceptTouchEvent不需要拦截这个事件，那也就没有必要将后续事件再传给它了。</p>
<p>因此，在dispatchTouchEvent中可以获得所有事件，其他两个方法不会每次事件传递都会调用。</p>
<p>有时间翻看源码来查看这个机制。（待填坑）</p>
<h2 id="ListView的adapter中没有数据显示指定view"><a href="#ListView的adapter中没有数据显示指定view" class="headerlink" title="ListView的adapter中没有数据显示指定view"></a>ListView的adapter中没有数据显示指定view</h2><p>当列表为空时，有时需要显示一个特殊的empty view来提示用户，一般情况下，<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ListView</span> <span class="attr">android:id</span>=<span class="string">"@+id/list"</span> <span class="attr">...</span>/ </span></span><br><span class="line">&lt;TextView android:id="@+id/empty" .../</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ListView list= (ListView)findViewById(R.id.mylist); </span><br><span class="line">TextView tv= (TextView)findViewById(R.id.myempty); </span><br><span class="line"></span><br><span class="line">list.setEmptyView(tv);</span><br></pre></td></tr></table></figure>
<p> 当列表为空时就会自动显示TextView </p>
<h2 id="activity相关"><a href="#activity相关" class="headerlink" title="activity相关"></a>activity相关</h2><p> A(singleTask)- B - B finish - A</p>
<p> 此时A仍然会走onCreate为何？</p>
<p> 抽象一个简单应用，B的类型为</p>
<p> standard/singleTop/singleTask/singleInstance</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">07-24 23:55:50.826 18366-18366/org.hseury.androiddemo E/BActivtiy: onPause</span><br><span class="line">07-24 23:55:50.846 18366-18366/org.hseury.androiddemo E/SplashActivity: onStart</span><br><span class="line">07-24 23:55:50.846 18366-18366/org.hseury.androiddemo E/SplashActivity: onResume</span><br><span class="line">07-24 23:55:51.276 18366-18366/org.hseury.androiddemo E/BActivtiy: onStop</span><br><span class="line">07-24 23:55:51.276 18366-18366/org.hseury.androiddemo E/BActivtiy: onDestroy</span><br></pre></td></tr></table></figure>
<p>四种情况下输出的log均一致，应该是遗留代码逻辑问题。</p>
<h2 id="内存泄漏"><a href="#内存泄漏" class="headerlink" title="内存泄漏"></a>内存泄漏</h2><h3 id="单例引起的内存泄漏"><a href="#单例引起的内存泄漏" class="headerlink" title="单例引起的内存泄漏"></a>单例引起的内存泄漏</h3><p>以下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AppManager instance;</span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">AppManager</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.context = context;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AppManager <span class="title">getInstance</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance != <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> AppManager(context);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是一个普通的单例模式，当创建这个单例的时候，由于需要传入一个Context，所以这个Context的生命周期的长短至关重要：</p>
<blockquote>
<p>传入的是Application的Context：这将没有任何问题，因为单例的生命周期和Application的一样长<br>传入的是Activity的Context：当这个Context所对应的Activity退出时，由于该Context和Activity的生命周期一样长（Activity间接继承于Context），所以当前Activity退出时它的内存并不会被回收，因为单例对象持有该Activity的引用。</p>
</blockquote>
<p>可以这样修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AppManager instance;</span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">AppManager</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//不管传入什么Context最终将使用Application的Context，而单例的生命周期和应用的一样长，这样就防止了内存泄漏</span></span><br><span class="line">        <span class="keyword">this</span>.context = context.getApplicationContext(); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AppManager <span class="title">getInstance</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance != <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> AppManager(context);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="加载so"><a href="#加载so" class="headerlink" title="加载so"></a>加载so</h2><h3 id="静态加载绝对路径的so相互依赖"><a href="#静态加载绝对路径的so相互依赖" class="headerlink" title="静态加载绝对路径的so相互依赖"></a>静态加载绝对路径的so相互依赖</h3><p>5.1源码里</p>
<p><code>/libcore/luni/src/main/java/java/lang/System.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * See &#123;<span class="doctag">@link</span> Runtime#load&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">load</span><span class="params">(String pathName)</span> </span>&#123;</span><br><span class="line">     Runtime.getRuntime().load(pathName, VMStack.getCallingClassLoader());</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * See &#123;<span class="doctag">@link</span> Runtime#loadLibrary&#125;.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loadLibrary</span><span class="params">(String libName)</span> </span>&#123;</span><br><span class="line">     Runtime.getRuntime().loadLibrary(libName, VMStack.getCallingClassLoader()); </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>其中<code>VMStack.getCallingClassLoader()</code>返回ClassLoader，这个classloader其实是PathClassLoader(如何得到的)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Returns the defining class loader of the caller's caller.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> the requested class loader, or &#123;<span class="doctag">@code</span> null&#125; if this is the</span></span><br><span class="line"><span class="comment">  *         bootstrap class loader.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">native</span> <span class="keyword">public</span> <span class="keyword">static</span> ClassLoader <span class="title">getCallingClassLoader</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Loads the given shared library using the given ClassLoader.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">load</span><span class="params">(String absolutePath, ClassLoader loader)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (absolutePath == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"absolutePath == null"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    String error = doLoad(absolutePath, loader);</span><br><span class="line">    <span class="keyword">if</span> (error != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsatisfiedLinkError(error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Searches for and loads the given shared library using the given ClassLoader.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loadLibrary</span><span class="params">(String libraryName, ClassLoader loader)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (loader != <span class="keyword">null</span>) &#123;</span><br><span class="line">        String filename = loader.findLibrary(libraryName);</span><br><span class="line">        <span class="keyword">if</span> (filename == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// It's not necessarily true that the ClassLoader used</span></span><br><span class="line">            <span class="comment">// System.mapLibraryName, but the default setup does, and it's</span></span><br><span class="line">            <span class="comment">// misleading to say we didn't find "libMyLibrary.so" when we</span></span><br><span class="line">            <span class="comment">// actually searched for "liblibMyLibrary.so.so".</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnsatisfiedLinkError(loader + <span class="string">" couldn't find \""</span> +</span><br><span class="line">                                           System.mapLibraryName(libraryName) + <span class="string">"\""</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        String error = doLoad(filename, loader);</span><br><span class="line">        <span class="keyword">if</span> (error != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnsatisfiedLinkError(error);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String filename = System.mapLibraryName(libraryName);  ②</span><br><span class="line">    List&lt;String&gt; candidates = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">    String lastError = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">for</span> (String directory : mLibPaths) &#123;</span><br><span class="line">        String candidate = directory + filename;</span><br><span class="line">        candidates.add(candidate);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (IoUtils.canOpenReadOnly(candidate)) &#123;</span><br><span class="line">            String error = doLoad(candidate, loader);</span><br><span class="line">            <span class="keyword">if</span> (error == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>; <span class="comment">// We successfully loaded the library. Job done.</span></span><br><span class="line">            &#125;</span><br><span class="line">            lastError = error;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (lastError != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsatisfiedLinkError(lastError);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> UnsatisfiedLinkError(<span class="string">"Library "</span> + libraryName + <span class="string">" not found; tried "</span> + candidates);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可见，无论是loadLibrary还是load，都会调用到doLoad方法。在此之前，如果是<code>loadLibrary</code>都会根据传入的<code>libraryName</code>来获取对应的<code>filename</code>，这里的<code>libraryName</code>的文件路径就通过<code>loader.findLibrary</code>和<code>System.mapLibraryName</code>来提供。</p>
<p><code>/libcore/dalvik/src/main/java/dalvik/system/BaseDexClassLoader.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">findLibrary</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> pathList.findLibrary(name);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>pathList就是我们的DexPathList对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Finds the named native code library on any of the library</span></span><br><span class="line"><span class="comment"> * directories pointed at by this instance. This will find the</span></span><br><span class="line"><span class="comment"> * one in the earliest listed directory, ignoring any that are not</span></span><br><span class="line"><span class="comment"> * readable regular files.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the complete path to the library or &#123;<span class="doctag">@code</span> null&#125; if no</span></span><br><span class="line"><span class="comment"> * library was found</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">findLibrary</span><span class="params">(String libraryName)</span> </span>&#123;</span><br><span class="line">    String fileName = System.mapLibraryName(libraryName);</span><br><span class="line">    <span class="keyword">for</span> (File directory : nativeLibraryDirectories) &#123;</span><br><span class="line">        String path = <span class="keyword">new</span> File(directory, fileName).getPath();</span><br><span class="line">        <span class="keyword">if</span> (IoUtils.canOpenReadOnly(path)) &#123;</span><br><span class="line">            <span class="keyword">return</span> path;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到<code>loader.findLibrary</code>走到最后也是走到<code>System.mapLibraryName</code>来提取路径的。但是findLibrary通过<code>nativeLibraryDirectories</code>来组成路径，②处是通过<code>mLibPath</code>来组成路径。其中的<code>getNativeLibraryDirectories</code>是</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** List of native library directories. */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> File[] nativeLibraryDirectories;</span><br></pre></td></tr></table></figure>
<p>这个<code>nativeLibraryDirectories</code>就是我们的自己项目中jniLibs下对应的so文件的路径。在构造函数中赋值。</p>
<p><code>/libcore/dalvik/src/main/java/dalvik/system/DexPathList.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs an instance.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> definingContext the context in which any as-yet unresolved</span></span><br><span class="line"><span class="comment"> * classes should be defined</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dexPath list of dex/resource path elements, separated by</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> File.pathSeparator&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> libraryPath list of native library directory path elements,</span></span><br><span class="line"><span class="comment"> * separated by &#123;<span class="doctag">@code</span> File.pathSeparator&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> optimizedDirectory directory where optimized &#123;<span class="doctag">@code</span> .dex&#125; files</span></span><br><span class="line"><span class="comment"> * should be found and written to, or &#123;<span class="doctag">@code</span> null&#125; to use the default</span></span><br><span class="line"><span class="comment"> * system directory for same</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">DexPathList</span><span class="params">(ClassLoader definingContext, String dexPath,</span></span></span><br><span class="line"><span class="function"><span class="params">        String libraryPath, File optimizedDirectory)</span> </span>&#123;</span><br><span class="line">    ......    </span><br><span class="line">    <span class="keyword">this</span>.nativeLibraryDirectories = splitLibraryPath(libraryPath);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Splits the given library directory path string into elements</span></span><br><span class="line"><span class="comment"> * using the path separator (&#123;<span class="doctag">@code</span> File.pathSeparator&#125;, which</span></span><br><span class="line"><span class="comment"> * defaults to &#123;<span class="doctag">@code</span> ":"&#125; on Android, appending on the elements</span></span><br><span class="line"><span class="comment"> * from the system library path, and pruning out any elements that</span></span><br><span class="line"><span class="comment"> * do not refer to existing and readable directories.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> File[] splitLibraryPath(String path) &#123;</span><br><span class="line">    <span class="comment">// Native libraries may exist in both the system and</span></span><br><span class="line">    <span class="comment">// application library paths, and we use this search order:</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//   1. this class loader's library path for application libraries</span></span><br><span class="line">    <span class="comment">//   2. the VM's library path from the system property for system libraries</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// This order was reversed prior to Gingerbread; see http://b/2933456.</span></span><br><span class="line">    ArrayList&lt;File&gt; result = splitPaths(path, System.getProperty(<span class="string">"java.library.path"</span>), <span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">return</span> result.toArray(<span class="keyword">new</span> File[result.size()]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DexPathList构造函数在<code>BaseDexClassLoader</code>构造函数中调用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs an instance.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dexPath the list of jar/apk files containing classes and</span></span><br><span class="line"><span class="comment"> * resources, delimited by &#123;<span class="doctag">@code</span> File.pathSeparator&#125;, which</span></span><br><span class="line"><span class="comment"> * defaults to &#123;<span class="doctag">@code</span> ":"&#125; on Android</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> optimizedDirectory directory where optimized dex files</span></span><br><span class="line"><span class="comment"> * should be written; may be &#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> libraryPath the list of directories containing native</span></span><br><span class="line"><span class="comment"> * libraries, delimited by &#123;<span class="doctag">@code</span> File.pathSeparator&#125;; may be</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> parent the parent class loader</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">BaseDexClassLoader</span><span class="params">(String dexPath, File optimizedDirectory,</span></span></span><br><span class="line"><span class="function"><span class="params">        String libraryPath, ClassLoader parent)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(parent);</span><br><span class="line">    <span class="keyword">this</span>.pathList = <span class="keyword">new</span> DexPathList(<span class="keyword">this</span>, dexPath, libraryPath, optimizedDirectory);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最终在<code>/libcore/libart/src/main/java/java/lang/ClassLoader.java</code>中看到classPath的赋值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Create the system class loader. Note this is NOT the bootstrap class</span></span><br><span class="line"><span class="comment"> * loader (which is managed by the VM). We use a null value for the parent</span></span><br><span class="line"><span class="comment"> * to indicate that the bootstrap loader is our parent.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> ClassLoader <span class="title">createSystemClassLoader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String classPath = System.getProperty(<span class="string">"java.class.path"</span>, <span class="string">"."</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PathClassLoader(classPath, BootClassLoader.getInstance());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs an instance.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dexPath the list of jar/apk files containing classes and</span></span><br><span class="line"><span class="comment"> * resources, delimited by &#123;<span class="doctag">@code</span> File.pathSeparator&#125;, which</span></span><br><span class="line"><span class="comment"> * defaults to &#123;<span class="doctag">@code</span> ":"&#125; on Android</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> optimizedDirectory directory where optimized dex files</span></span><br><span class="line"><span class="comment"> * should be written; may be &#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> libraryPath the list of directories containing native</span></span><br><span class="line"><span class="comment"> * libraries, delimited by &#123;<span class="doctag">@code</span> File.pathSeparator&#125;; may be</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> parent the parent class loader</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">BaseDexClassLoader</span><span class="params">(String dexPath, File optimizedDirectory,</span></span></span><br><span class="line"><span class="function"><span class="params">        String libraryPath, ClassLoader parent)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(parent);</span><br><span class="line">    <span class="keyword">this</span>.pathList = <span class="keyword">new</span> DexPathList(<span class="keyword">this</span>, dexPath, libraryPath, optimizedDirectory);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">doLoad</span><span class="params">(String name, ClassLoader loader)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Android apps are forked from the zygote, so they can't have a custom LD_LIBRARY_PATH,</span></span><br><span class="line">        <span class="comment">// which means that by default an app's shared library directory isn't on LD_LIBRARY_PATH.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// The PathClassLoader set up by frameworks/base knows the appropriate path, so we can load</span></span><br><span class="line">        <span class="comment">// libraries with no dependencies just fine, but an app that has multiple libraries that</span></span><br><span class="line">        <span class="comment">// depend on each other needed to load them in most-dependent-first order.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// We added API to Android's dynamic linker so we can update the library path used for</span></span><br><span class="line">        <span class="comment">// the currently-running process. We pull the desired path out of the ClassLoader here</span></span><br><span class="line">        <span class="comment">// and pass it to nativeLoad so that it can call the private dynamic linker API.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// We didn't just change frameworks/base to update the LD_LIBRARY_PATH once at the</span></span><br><span class="line">        <span class="comment">// beginning because multiple apks can run in the same process and third party code can</span></span><br><span class="line">        <span class="comment">// use its own BaseDexClassLoader.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// We didn't just add a dlopen_with_custom_LD_LIBRARY_PATH call because we wanted any</span></span><br><span class="line">        <span class="comment">// dlopen(3) calls made from a .so's JNI_OnLoad to work too.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// So, find out what the native library search path is for the ClassLoader in question...</span></span><br><span class="line">        String ldLibraryPath = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (loader != <span class="keyword">null</span> &amp;&amp; loader <span class="keyword">instanceof</span> BaseDexClassLoader) &#123;</span><br><span class="line">            ldLibraryPath = ((BaseDexClassLoader) loader).getLdLibraryPath();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// nativeLoad should be synchronized so there's only one LD_LIBRARY_PATH in use regardless</span></span><br><span class="line">        <span class="comment">// of how many ClassLoaders are in the system, but dalvik doesn't support synchronized</span></span><br><span class="line">        <span class="comment">// internal natives.</span></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> nativeLoad(name, loader, ldLibraryPath);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>最终都会走到nativeLoad方法，通过jni去调用c++代码，通过synchronized可见，这个操作是加锁的。其中这个<code>LD_LIBRARY_PATH</code>是从pathlist中取getNativeLibraryDirectories。</p>
<p><code>/libcore/dalvik/src/main/java/dalvik/system/BaseDexClassLoader.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">getLdLibraryPath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     StringBuilder result = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">     <span class="keyword">for</span> (File directory : pathList.getNativeLibraryDirectories()) &#123;</span><br><span class="line">         <span class="keyword">if</span> (result.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">             result.append(<span class="string">':'</span>);</span><br><span class="line">         &#125;</span><br><span class="line">         result.append(directory);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> result.toString();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>通过反射，可以把这个路径<code>nativeLibraryDirectories</code>打印出来</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">07-30 20:38:12.362 26198-26198/org.hseury.testtt E/hseury: path = /data/app-lib/org.hseury.testtt-3</span><br><span class="line">07-30 20:38:12.362 26198-26198/org.hseury.testtt E/hseury: path = /vendor/lib</span><br><span class="line">07-30 20:38:12.362 26198-26198/org.hseury.testtt E/hseury: path = /system/lib</span><br></pre></td></tr></table></figure>
<p>可见遇到sytem.load()指定路径的so时，如果有依赖关系，就会出现找不到库的问题。假设A.so依赖于B.so，那么</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.load(PathToA/A.so);</span><br><span class="line">System.load(PathToB/B.so);</span><br></pre></td></tr></table></figure>
<p>就会出现问题，可以通过hook修改<code>nativeLibraryDirectories</code>的方法来解决。</p>
<h1 id="persistent-为true，预装时候crash，报找不到类的问题"><a href="#persistent-为true，预装时候crash，报找不到类的问题" class="headerlink" title="persistent 为true，预装时候crash，报找不到类的问题"></a>persistent 为true，预装时候crash，报找不到类的问题</h1><p>一般没有persist属性的应用在进行应用自升级的时候，系统会保证程序运行的状态是OK的，因为在安装应用（应用自升级）的过程中，系统会KILL此应用的进程，同时清理之前在AMS（ActivityManagerService）中记录的此应用进程中的各种组件（Activity，Service,Receiver,ContentProvider），在下次该新版本的应用重新启动时，系统会重新new一个进程并重新加载各种组件运行，所以不会有问题；当应用有persist属性并且生效时（不但要添加persist标签，还要是系统签名或者有系统权限），系统安装新应用的过程与安装不带此属性的过程不同，主要在是因为：系统不会KILL此应用的进程。系统不会清理之前在AMS（ActivityManagerService）中记录的各种组件的信息，只会把新版应用中的各种组件记录到AMS中。这样的话如果前后2个版本的应用的某个组件（如Actvivity）名称没有变化，但是内部增加了很多新的类和新的逻辑实现，就会导致加载的组件有的是新版本的有的是老版本，导致程序功能错乱。</p>
<p>可以参考<a href="http://blog.csdn.net/asanwang007/article/details/54178350" target="_blank" rel="noopener">Android应用具有persist属性时如何自升级</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpeg"
               alt="hseury" />
          <p class="site-author-name" itemprop="name">hseury</p>
           
              <p class="site-description motion-element" itemprop="description">It takes everything.</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hseury</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  
    

    
  





  






  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("G5Gx27o48b9rkGKbW2mLP0lX-gzGzoHsz", "VojNz6ENWKxPoQLbOSfC0kTA");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

  

  
</body>
</html>
