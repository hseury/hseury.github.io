<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/images/avatar.jpeg?v=5.1.1" />






<meta name="description" content="布局 主布局launcher.xml中， 最外层是LauncherRootView，重写了一个方法， View.fitSystemWindow(rect), 如果你的View在status bar或者navigation bar之下，那么这个方法会传递进去一个参数，说明这个View的四周有多少是被status bar或者navigation bar挡住了的。  Called by the view">
<meta property="og:type" content="article">
<meta property="og:title" content="Launcher的备忘">
<meta property="og:url" content="http://yoursite.com/2018/01/12/everything-about-Launcher/index.html">
<meta property="og:site_name" content="HSEURY_POINTER">
<meta property="og:description" content="布局 主布局launcher.xml中， 最外层是LauncherRootView，重写了一个方法， View.fitSystemWindow(rect), 如果你的View在status bar或者navigation bar之下，那么这个方法会传递进去一个参数，说明这个View的四周有多少是被status bar或者navigation bar挡住了的。  Called by the view">
<meta property="og:updated_time" content="2018-01-14T08:58:17.591Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Launcher的备忘">
<meta name="twitter:description" content="布局 主布局launcher.xml中， 最外层是LauncherRootView，重写了一个方法， View.fitSystemWindow(rect), 如果你的View在status bar或者navigation bar之下，那么这个方法会传递进去一个参数，说明这个View的四周有多少是被status bar或者navigation bar挡住了的。  Called by the view">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/01/12/everything-about-Launcher/"/>





  <title>Launcher的备忘 | HSEURY_POINTER</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  















  
  
    
  

  <div class="container sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">HSEURY_POINTER</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Be kind, always.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-android">
          <a href="/categories/android" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            android
          </a>
        </li>
      
        
        <li class="menu-item menu-item-travel">
          <a href="/categories/travel" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            穿越世界的旅行
          </a>
        </li>
      
        
        <li class="menu-item menu-item-ios">
          <a href="/categories/ios" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            ios开发
          </a>
        </li>
      
        
        <li class="menu-item menu-item-backend">
          <a href="/categories/backend" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            后台开发
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/12/everything-about-Launcher/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hseury">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HSEURY_POINTER">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Launcher的备忘</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-12T09:22:49+08:00">
                2018-01-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/01/12/everything-about-Launcher/" class="leancloud_visitors" data-flag-title="Launcher的备忘">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h1><hr>
<p>主布局<code>launcher.xml</code>中， 最外层是<code>LauncherRootView</code>，重写了一个方法， View.fitSystemWindow(rect), 如果你的View在status bar或者navigation bar之下，那么这个方法会传递进去一个参数，说明这个View的四周有多少是被status bar或者navigation bar挡住了的。</p>
<blockquote>
<p>Called by the view hierarchy when the content insets for a window have changed, to allow it to adjust its content to fit within those windows. The content insets tell you the space that the status bar, input method, and other system windows infringe on the application’s window.</p>
</blockquote>
<p>这个方法的会调用父类的setInsets()方法，我们来看看父类InsettableFrameLayout。</p>
<p>InsettableFrameLayout继承了FrameLayout， 并且实现了父类的一些方法，总的来说，他的目的就是给子View都设定一个Margin值，防止被status bar或者navigation bar挡住。如果一个View已经是<code>Insettable</code>(一个接口)的了，那么就忽略他。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setInsets</span><span class="params">(Rect insets)</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> n = getChildCount();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">final</span> View child = getChildAt(i);</div><div class="line">        setFrameLayoutChildInsets(child, insets, mInsets);</div><div class="line">    &#125;</div><div class="line">    mInsets.set(insets);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFrameLayoutChildInsets</span><span class="params">(View child, Rect newInsets, Rect oldInsets)</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> LayoutParams lp = (LayoutParams) child.getLayoutParams();</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (child <span class="keyword">instanceof</span> Insettable) &#123;</div><div class="line">        ((Insettable) child).setInsets(newInsets);</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!lp.ignoreInsets) &#123;</div><div class="line">        lp.topMargin += (newInsets.top - oldInsets.top);</div><div class="line">        lp.leftMargin += (newInsets.left - oldInsets.left);</div><div class="line">        lp.rightMargin += (newInsets.right - oldInsets.right);</div><div class="line">        lp.bottomMargin += (newInsets.bottom - oldInsets.bottom);</div><div class="line">    &#125;</div><div class="line">    child.setLayoutParams(lp);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在Launcher3中，Workspace， DragLayer和AppsCustomizeTabHost都实现了这个接口，那么他们自身就不会被加Margin， 而搜索栏和Hotseat都没有实现这个接口，那么说明他们在被加到父亲上得时候会被设一个Margin，最后的到得效果就是搜索栏刚好在status bar之下（gravity为top，topmargin是status bar的高度），Hotseat刚好在navigation bar的上方（gravity为bottom，bottomMargin为navigation bar的高度）</p>
<p><code>DragLayer</code></p>
<p>一个协调处理它的子view拖动的容器.</p>
<ul>
<li><a href="http://blog.csdn.net/qq_31530015/article/details/51548413" target="_blank" rel="external">Android4.4-Launcher源码分析系列之关键的类和接口之DragLayer</a></li>
</ul>
<p><code>Workspace</code></p>
<p>抽象的桌面。由N个celllaout组成，从CellLayout更高一级的层面上对事件的处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Workspace</span> <span class="keyword">extends</span> <span class="title">SmoothPagedView</span> <span class="keyword">implements</span> <span class="title">DropTarget</span>, <span class="title">DragSource</span>, <span class="title">DragScroller</span>, <span class="title">View</span>.<span class="title">OnTouchListener</span>,  </span></div><div class="line">        <span class="title">DragController</span>.<span class="title">DragListener</span>, <span class="title">LauncherTransitionable</span>, <span class="title">ViewGroup</span>.<span class="title">OnHierarchyChangeListener</span>,  </div><div class="line">        <span class="title">Insettable</span> &#123;</div><div class="line">        	.......</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<ul>
<li><a href="http://blog.csdn.net/qq_31530015/article/details/51577154" target="_blank" rel="external">Android4.4-Launcher源码分析系列之WorkSpace及屏幕滑动</a></li>
</ul>
<p>既是一个拖动的容器也是一个拖动的源</p>
<p><code>Hotseat</code></p>
<p>Hotseat里面其实也是一个CellLayout负责管理内部的元素。</p>
<p><code>PageIndicator</code></p>
<p>dock栏上面的点点，默认横屏状态下没有。</p>
<p>在xml文件中，这些空间基本上都是FrameLayout，在<code>Launcher.java</code>的onCreate方法里进行布局的配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">   	......</div><div class="line">       <span class="comment">//初始化，但是xml里面的布局文件都没有设置绝对属性</span></div><div class="line">       setContentView(R.layout.launcher);</div><div class="line">       <span class="comment">//绑定监听</span></div><div class="line">       setupViews();</div><div class="line">       <span class="comment">//根据设备取出的信息来绘制</span></div><div class="line">       grid.layout(<span class="keyword">this</span>);</div><div class="line">       ......</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>其中grid.layout则是设置对各个控件的大小和位置<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">layout</span><span class="params">(Launcher launcher)</span> </span>&#123;</div><div class="line">	    <span class="comment">// Layout the workspace</span></div><div class="line">      PagedView workspace = (PagedView) launcher.findViewById(R.id.workspace);</div><div class="line">      lp = (FrameLayout.LayoutParams) workspace.getLayoutParams();</div><div class="line">      lp.gravity = Gravity.CENTER;</div><div class="line">      <span class="keyword">int</span> orientation = isLandscape ? CellLayout.LANDSCAPE : CellLayout.PORTRAIT;</div><div class="line">      Rect padding = getWorkspacePadding(orientation);</div><div class="line">      workspace.setLayoutParams(lp);</div><div class="line">      workspace.setPadding(padding.left, padding.top, padding.right, padding.bottom);</div><div class="line">      workspace.setPageSpacing(getWorkspacePageSpacing(orientation));</div><div class="line"></div><div class="line">      <span class="comment">// Layout the hotseat</span></div><div class="line">      View hotseat = launcher.findViewById(R.id.hotseat);</div><div class="line">      ......</div><div class="line"></div><div class="line">      <span class="comment">// Layout the page indicators</span></div><div class="line">      View pageIndicator = launcher.findViewById(R.id.page_indicator);</div><div class="line">      ......</div><div class="line"></div><div class="line">      <span class="comment">// Layout AllApps</span></div><div class="line">      AppsCustomizeTabHost host = (AppsCustomizeTabHost)</div><div class="line">              launcher.findViewById(R.id.apps_customize_pane);</div><div class="line">      ......</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="数据加载"><a href="#数据加载" class="headerlink" title="数据加载"></a>数据加载</h1><p><code>LauncherModel</code><br>继承BroadcastReceiver,由此可知他是一个广播接收器,用来接收广播,另外,LauncherModel还主要加载数据;</p>
<p><code>LauncherProvider</code><br>继承ContentProvider,主要是处理数据库操作;</p>
<p><code>LauncherAppState</code><br>单例模式的全局管理类,主要是初始化一些对象,注册广播等.</p>
<p>默认数据写在<code>default_workspace_4x4.xml</code>,<code>default_workspace_5x5.xml</code>和<code>default_workspace_5x6.xml</code>这几个xml文件中</p>
<p>当所有信息初始化完成后，就开始调用mModel.startLoader方法来加载应用数据。</p>
<p><code>loadAndBindWorkspace</code>方法，加载workspace的应用并且进行绑定，content里面取。</p>
<p><code>waitForIdle</code>方法，改方法主要是等待加载数据结束</p>
<p><code>loadAndBindAllApps</code>方法，加载第二层的多有图标信息</p>
<p><code>bindWorkspace</code>将数据和view进行绑定</p>
<h1 id="应用安装、更新、卸载时的数据加载"><a href="#应用安装、更新、卸载时的数据加载" class="headerlink" title="应用安装、更新、卸载时的数据加载"></a>应用安装、更新、卸载时的数据加载</h1><p>首先区分收到广播是安装、更新、移除还是不可用，然后对不同的操作执行不同的处理，对于添加的调用addAppsToAllApps这个方法进行处理，最后调用callbacks.bindAppsAdded方法进行绑定，更新的调用callbacks.bindAppsUpdated这个方法进行更新操作</p>
<h1 id="Workspace滑动"><a href="#Workspace滑动" class="headerlink" title="Workspace滑动"></a>Workspace滑动</h1><p><code>Workspace</code>继承<code>PagedView</code>，而<code>PagedView</code>又继承<code>ViewGroup</code>，<code>PagedView</code>是分页的自定义View</p>
<p>滑动事件有五种状态</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> TOUCH_STATE_REST = <span class="number">0</span>;</div><div class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> TOUCH_STATE_SCROLLING = <span class="number">1</span>;</div><div class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> TOUCH_STATE_PREV_PAGE = <span class="number">2</span>;</div><div class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> TOUCH_STATE_NEXT_PAGE = <span class="number">3</span>;</div><div class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> TOUCH_STATE_REORDERING = <span class="number">4</span>;</div></pre></td></tr></table></figure>
<p>第一个是初始状态，第二个是滚动状态，第三个是向前翻页状态，第四个是向后翻页状态，最后一个是排序状态（长按桌面的情况下，workspace缩小，此时你可以长按CellLayout拖动进行排序)</p>
<h1 id="拖曳事件"><a href="#拖曳事件" class="headerlink" title="拖曳事件"></a>拖曳事件</h1><p>图标拖拽的触发条件是长按事件，<code>Launcher</code>类的<code>onLongClick</code>方法。</p>
<p>DragController中的onTouch方法是在DragLayer中的onTouch方法中调用的</p>
<p><code>DragLayer.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</div><div class="line">       ......</div><div class="line">       <span class="keyword">return</span> mDragController.onTouchEvent(ev);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p><code>DragController.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleMoveEvent</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">    mDragObject.dragView.move(x, y);</div><div class="line"></div><div class="line">    <span class="comment">// Drop on someone?</span></div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span>[] coordinates = mCoordinatesTemp;</div><div class="line">    <span class="comment">//查找DropTarget</span></div><div class="line">    DropTarget dropTarget = findDropTarget(x, y, coordinates);</div><div class="line">    mDragObject.x = coordinates[<span class="number">0</span>];</div><div class="line">    mDragObject.y = coordinates[<span class="number">1</span>];</div><div class="line">    checkTouchMove(dropTarget);</div><div class="line"></div><div class="line">    <span class="comment">// Check if we are hovering over the scroll areas</span></div><div class="line">    mDistanceSinceScroll +=</div><div class="line">        Math.sqrt(Math.pow(mLastTouch[<span class="number">0</span>] - x, <span class="number">2</span>) + Math.pow(mLastTouch[<span class="number">1</span>] - y, <span class="number">2</span>));</div><div class="line">    mLastTouch[<span class="number">0</span>] = x;</div><div class="line">    mLastTouch[<span class="number">1</span>] = y;</div><div class="line">    checkScrollState(x, y);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>DropTarget</code><br>拖动你的View要放入的地方，比如folder，workspace等</p>
<p><code>DragObject</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Interface defining an object that can receive a drag.</div><div class="line"> *</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DropTarget</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"DropTarget"</span>;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DragObject</span> </span>&#123;</div><div class="line">        ......</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mDragObject = <span class="keyword">new</span> DropTarget.DragObject();</div></pre></td></tr></table></figure>
<p><code>DragView</code><br>拖拽的是DragView对象</p>
<p><code>DragSource</code><br>标记拖曳事件哪里产生，比如workspace、floder<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Interface defining an object that can originate a drag.</div><div class="line"> *</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DragSource</span> </span>&#123;</div><div class="line">    ......</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>acceptDrop函数用来判断dropTarget是否可以接受item放置在自己里面。</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/01/07/yunnan/" rel="next" title="云南——不会再去的地方">
                <i class="fa fa-chevron-left"></i> 云南——不会再去的地方
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="uyan_frame"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpeg"
               alt="hseury" />
          <p class="site-author-name" itemprop="name">hseury</p>
           
              <p class="site-description motion-element" itemprop="description">It takes everything.</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#布局"><span class="nav-number">1.</span> <span class="nav-text">布局</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据加载"><span class="nav-number">2.</span> <span class="nav-text">数据加载</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#应用安装、更新、卸载时的数据加载"><span class="nav-number">3.</span> <span class="nav-text">应用安装、更新、卸载时的数据加载</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Workspace滑动"><span class="nav-number">4.</span> <span class="nav-text">Workspace滑动</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#拖曳事件"><span class="nav-number">5.</span> <span class="nav-text">拖曳事件</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hseury</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  
    

    
      <!-- UY BEGIN -->
      <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2137619"></script>
      <!-- UY END -->
    
  





  






  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("G5Gx27o48b9rkGKbW2mLP0lX-gzGzoHsz", "VojNz6ENWKxPoQLbOSfC0kTA");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

  

  
</body>
</html>
